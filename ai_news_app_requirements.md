# 要件定義書 (骨子) - AIニュースレポート自動生成アプリケーション

## 1. 概要

### 1.1. 背景:

*   AI技術の進化は速く、関連ニュースを効率的に収集・把握する必要性が高まっている。
*   手動での情報収集は時間がかかり、情報の網羅性にも限界がある。

### 1.2. 目的:

*   ユーザーが簡単な操作で、AI関連の最新ニュースをまとめたレポートを自動生成・閲覧できるWebアプリケーションを提供する。
*   情報収集の効率化と、AIトレンドの迅速な把握を支援する。

### 1.3. 範囲:

**範囲内:**

*   Webアプリケーションの開発（フロントエンド、バックエンド）。
*   ユーザーが指定した期間（例: 過去24時間、過去7日間など選択可能）のAIニュースレポート生成依頼機能。
*   レポート生成タスクの状態表示機能。
*   生成されたAIニュースレポートの表示機能。
*   Mastraフレームワークを用いたAIエージェントによるニュース収集、フィルタリング機能。
*   バックエンド(Go/Gin)、フロントエンド(TypeScript/React/Tailwind CSS)、AIエージェント(Mastra/Node.js)の構成。
*   ニュースソースとキーワードは設定ファイルで管理し、将来的な拡張を可能にする。

**範囲外 (初期スコープ):**

*   ユーザーアカウント管理、パーソナライズ機能。
*   レポートのカスタマイズ機能（キーワード指定、情報源選択など）。*ただし、キーワードは設定ファイルで管理*
*   AI分野以外のニュース収集。
*   レポートのエクスポート機能。
*   ニュース記事の要約生成機能。

### 1.4. 対象利用者:

*   AI技術の動向に関心を持つ個人・法人。
    *   (例: 研究者、開発者、エンジニア、プロダクトマネージャー、経営企画担当者、学生など)

## 2. 機能要件

### 2.1. レポート生成依頼:

*   ユーザーは、Web UI上で期間（例: 過去24時間、過去7日間など）を選択し、その期間のAIニュースレポート生成をシステムに依頼できる。

### 2.2. タスク状態表示:

*   ユーザーは、依頼したレポート生成タスクの現在の状態（例: 受付済、処理中、完了、失敗）を確認できる。

### 2.3. レポート表示:

*   ユーザーは、生成されたAIニュースレポートをWeb画面上で閲覧できる。
*   レポートには、収集されたニュース記事の情報（タイトル、発行元、発行日時、記事へのリンク、(オプション)要約）がリスト形式などで表示される。

### 2.4. ニュース収集 (システム内部):

*   システム(Mastraエージェント)は、設定ファイルで定義されたニュースソース（API、RSSフィード）から、設定ファイルで定義されたキーワード（例: 「AI」「人工知能」）に基づいて記事を収集する。キーワードは将来的に追加・変更可能とする。

### 2.5. ニュースフィルタリング (システム内部):

*   システム(Mastraエージェント)は、収集した記事からAIに関連性の高いものをフィルタリングし、重複を除去する。初期リリースでは、タイトルや本文に対する単純なキーワードマッチングによるフィルタリングを行う。

### 2.6. (オプション) 要約生成 (システム内部):

*   (この機能は初期スコープ外とする)

## 3. 非機能要件

### 3.1. パフォーマンス:

*   レポート生成依頼から完了までの時間は、通常 **5分** 以内とする。
*   Web画面の応答時間は、通常 **1秒** 以内を目標とする。

### 3.2. 信頼性:

*   外部API（ニュース、LLM）のエラー発生時にも、システム全体が停止しないこと。
*   エラー発生時には、ユーザーに適切なフィードバックを行うこと。
*   レポート生成処理が安定して動作すること。

### 3.3. セキュリティ:

*   外部APIキーなどの機密情報は `.env` ファイル等で管理し、ソースコードリポジトリには含めない (`.gitignore` で管理)。安全な管理方法を維持する。
*   (将来的なユーザー機能追加を見据え、適切なセキュリティ対策を考慮する)

### 3.4. 保守性:

*   Goバックエンド、TypeScriptフロントエンド、Mastraエージェントのコードは、構造化され、可読性が高く、保守しやすいように記述する。
*   主要な処理にはコメントやドキュメントを付与する。

### 3.5. 使用性 (ユーザビリティ):

*   ユーザーインターフェースは直感的で、特別なマニュアルなしで操作できること。

## 4. 制約条件

### 4.1. 使用技術:

*   バックエンド: Go言語 (v1.22.x), Ginフレームワーク
*   フロントエンド: TypeScript (v5.x), React (v18.x), Tailwind CSS
*   AIエージェント: Mastra (最新版, Node.js v20.x LTS 環境で動作)

### 4.2. 外部API利用:

*   **GNews API** ([https://gnews.io/](https://gnews.io/)) の利用を前提とする。
*   LLM APIは初期スコープでは利用しない。
*   各APIの利用規約、料金体系、レート制限に従う必要がある。

### 4.3. 開発リソース・期間:

*   (※プロジェクトに応じて具体的に記述)

---

# 仕様書 (骨子) - AIニュースレポート自動生成アプリケーション

## 1. システム構成

### 1.1. 全体構成図:

*   (図を挿入: ブラウザ <-> [TS Frontend] <-> [Go Backend API] <-> [Mastra Service API] <-> [DB] / [外部News API] / [外部LLM API])

### 1.2. 技術スタック詳細:

*   **Go:** バージョン 1.22.x, フレームワーク (Gin)
*   **Node.js:** バージョン 20.x LTS (Mastra実行環境)
*   **Mastra:** 最新版 (※具体的なバージョンは環境構築時に確認)
*   **TypeScript:** バージョン 5.x, フレームワーク (React 18.x), UIライブラリ (Tailwind CSS)
*   **データベース:** PostgreSQL 16.x
*   **その他:** (Docker, etc.)

### 1.3. 外部サービス連携:

*   **ニュースAPI:** **GNews API** ([https://gnews.io/](https://gnews.io/)) - エンドポイント、認証方法、利用プランを記載。
*   **RSSフィード:** (例: TechCrunch Japan, ITmedia NEWS AI+, Zenn [AIタグ]) - URLリスト (YAML形式の設定ファイルで管理)
*   **LLM API (オプション):** (初期スコープ外)

## 2. 画面仕様

### 2.1. ダッシュボード画面:

*   **レイアウト:** ヘッダーにアプリ名。メインエリアにレポート生成期間選択UI、生成依頼ボタン、タスクステータス/最終更新日時表示。その下に記事リストを表示するシンプルな構成。(ワイヤーフレーム/モックアップがあれば挿入)
*   **主要コンポーネント:**
    *   レポート生成期間選択 (例: ドロップダウンで「過去24時間」「過去7日間」など)
    *   レポート生成依頼ボタン (例: 「最新のAIニュースを更新」)
    *   タスクステータス表示エリア (例: 「レポート生成中...」「前回の更新: YYYY/MM/DD HH:MM」「失敗しました」)
    *   レポート表示エリア:
        *   レポート生成日時
        *   記事リスト (カード形式で各記事に以下を表示)
            *   記事タイトル
            *   発行元 (Source)
            *   発行日時 (Published At)
            *   記事URLへのリンク
        *   ページネーションまたは無限スクロール機能で全記事を閲覧可能にする。

## 3. API仕様

### 3.1. Go Backend API (フロントエンド向け):

*   `POST /api/reports`: レポート生成タスク依頼
    *   Request Body: (オプション: `{ "period": "24h" }` など)
    *   Response: `{ "taskId": "...", "status": "PENDING" }`
*   `GET /api/tasks/{taskId}/status`: タスク状態取得 (フロントエンドからポーリングで利用)
    *   Response: `{ "status": "PENDING" | "RUNNING" | "COMPLETED" | "FAILED" }`
*   `GET /api/reports/latest`: 最新レポート取得
    *   Response: `{ "reportId": "...", "generatedAt": "...", "articles": [...] }` (Article構造は後述)
*   `GET /api/reports/{reportId}`: 指定レポート取得 (オプション)

### 3.2. Mastra Service API (Goバックエンド向け):

*   `POST /agent/generate-ai-news`: レポート生成実行指示
    *   Request Body: `{ "period": "24h", "callbackUrl": "http://go-backend/api/internal/report-callback/{taskId}" }`
    *   Response: `{ "message": "Task accepted" }`

### 3.3. Go Backend Callback API (Mastraサービス向け):

*   `POST /api/internal/report-callback/{taskId}`: レポート生成結果通知
    *   Request Body: `{ "status": "COMPLETED" | "FAILED", "report": { "generatedAt": "...", "articles": [...] } | null, "error": "..." | null }`

## 4. データモデル

### 4.1. データベーススキーマ (例: PostgreSQL):

*   **tasks テーブル:**
    *   `id` (UUID, PK)
    *   `status` (VARCHAR: PENDING, RUNNING, COMPLETED, FAILED)
    *   `requested_at` (TIMESTAMP)
    *   `completed_at` (TIMESTAMP, nullable)
    *   `report_id` (UUID, nullable, FK to reports.id)
    *   `error_message` (TEXT, nullable)
*   **reports テーブル:**
    *   `id` (UUID, PK)
    *   `generated_at` (TIMESTAMP)
    *   `articles` (JSONB) Article配列を格納

### 4.2. Article 構造 (JSON):

*   `title` (TEXT)
*   `url` (TEXT, UNIQUE)
*   `source_name` (TEXT)
*   `published_at` (TIMESTAMP)
*   `summary` (TEXT, nullable) オプション

## 5. Mastraエージェント仕様

### 5.1. エージェント名: `aiNewsReportAgent` (仮)

### 5.2. ワークフロー詳細:

1.  GoバックエンドからのHTTPリクエスト(`POST /agent/generate-ai-news`) をトリガーとする。
2.  パラメータ (`period`, `callbackUrl`) を取得。
3.  **ニュース収集:** YAML設定ファイルで定義されたニュースソースリストに基づき、指定期間・キーワードで記事を並列収集 (axios, node-fetch等利用)。
4.  **フィルタリング・重複排除:** 収集した記事URLをキーに重複を排除。タイトルや本文からキーワード適合度を判定しフィルタリング（単純なキーワードマッチ）。
5.  **(オプション) 要約生成:** (初期スコープ外)
6.  **フォーマット:** 結果を Article 構造の配列としてJSONに整形。
7.  **結果通知:** Goバックエンドの `callbackUrl` にHTTP POSTリクエストで結果 (成功/失敗、レポートデータ/エラーメッセージ) を送信。

### 5.3. 使用ツール/インテグレーション:

*   Mastra Workflow Engine
*   Mastra RAG (フィルタリングや文脈理解に利用する場合)
*   HTTP Client (axios, node-fetch)
*   (オプション) LLM Client Library (openai-node, etc.)
*   使用するニュースAPIのクライアントライブラリ (あれば)

## 6. 非機能要件詳細

### 6.1. エラーハンドリング:

*   ニュースAPIアクセスエラー、タイムアウト等のケースを考慮。
*   外部API呼び出し失敗時には、リトライ処理を実装 (最大3回、指数バックオフ方式を推奨)。
*   Goバックエンド、Mastraサービス双方で適切なエラーログを記録。
*   タスク失敗時には `tasks` テーブルにエラー情報を記録し、フロントエンドにも失敗した旨を伝える。

### 6.2. ログ記録:

*   **Goバックエンド:** リクエスト受付、Mastra連携、DB操作、エラー発生時にログ出力 (ログレベル: INFO, WARN, ERROR)。
*   **Mastraサービス:** タスク開始/終了、ニュース収集状況、フィルタリング結果、LLM連携、エラー発生時にログ出力。
*   (ログフォーマット、出力先などは要検討)

---

*以上が骨子となります。各項目について、具体的な内容、数値目標、詳細なアルゴリズム、UIデザインなどをチームで議論し、肉付けしていくことで、実際の開発に使えるドキュメントになります。*